<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>南部航務中心115年員工聯誼暨CIQS茶會人員配置圖</title>
    <style>
        /* --- 全局背景設定 --- */
        body { font-family: "Microsoft JhengHei", sans-serif; background: #333; display: flex; padding: 20px; gap: 20px; margin: 0; height: 100vh; overflow: hidden; }
        
        /* 左側管理面板 */
        .admin-panel { 
            width: 340px; background: #fff; padding: 20px; border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); height: 95vh; 
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            position: relative; z-index: 10;
        }
        .admin-panel.collapsed { transform: translateX(-380px); position: absolute; }
        .collapse-btn { position: absolute; top: 10px; right: 10px; background: #eee; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold; }
        .expand-btn { position: fixed; top: 20px; left: 0; z-index: 20; background: #333; color: white; border: none; padding: 10px 15px 10px 5px; border-radius: 0 50px 50px 0; cursor: pointer; font-weight: bold; transition: left 0.3s ease; }
        .expand-btn.hidden { left: -50px; }
        textarea { flex-grow: 1; width: 100%; font-family: monospace; padding: 10px; border: 1px solid #ccc; font-size: 13px; resize: none; border-radius: 4px; box-sizing: border-box; }
        .stats-summary { margin-top: 10px; padding: 10px; background: #f1f8e9; border-radius: 4px; font-size: 13px; font-weight: bold; border-left: 4px solid #4caf50; }
        .options-box { margin-top: 15px; font-weight: bold; color: #333; font-size: 14px; border-top: 1px solid #eee; padding-top: 10px; }
        .options-box label { cursor: pointer; display: flex; align-items: center; gap: 5px; }

        /* 右側圖表區 */
        .chart-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; gap: 30px; overflow-y: auto; height: 95vh; width: 100%; }
        
        /* --- 核心畫布 --- */
        .canvas { 
            width: 1100px; 
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            border: 1px solid #ccc; padding: 40px; 
            position: relative; 
            flex-shrink: 0; margin-top: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; align-items: center;
        }

        /* 絕對定位設施區 */
        .left-facilities-area {
            position: absolute; left: 20px; top: 40px; bottom: 40px;
            width: 80px; display: flex; flex-direction: column; align-items: center;
        }
        .restroom-group { display: flex; gap: 5px; margin-bottom: 250px; }
        .restroom-box { border: 2px solid #555; padding: 8px 5px; width: 40px; text-align: center; font-weight: bold; font-size: 13px; color: #555; background: #fff; }
        .elevator-box { border: 2px solid #555; padding: 20px 5px; width: 60px; text-align: center; background: #eee; font-weight: bold; font-size: 14px; color: #333; }

        /* 絕對定位牆壁 */
        .divider-wall {
            position: absolute; left: 110px; top: 40px; bottom: 40px;
            width: 10px; background: #444; border-radius: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2); z-index: 5;
        }

        /* 宴會廳 */
        .banquet-hall {
            width: 100%; padding-left: 100px; box-sizing: border-box;
            display: flex; flex-direction: column; align-items: center;
        }

        .stage-box { background: #d32f2f; color: white; padding: 15px 120px; font-weight: 900; border: 2px solid #b71c1c; font-size: 24px; letter-spacing: 5px; box-shadow: 0 4px 0 #922b21; border-radius: 4px; margin-bottom: 40px; position: relative;}
        .sound-control { position: absolute; top: 20px; right: 20px; border: 1px solid #000; padding: 8px; background: #eee; font-size: 12px; font-weight: bold; }

        /* --- 主桌 --- */
        .main-vip-wrapper { display: flex; justify-content: center; align-items: center; gap: 10px; width: 100%; margin-bottom: 50px; }
        .main-table-circle { 
            width: 160px; height: 160px; border-radius: 50%; border: 4px solid #1565c0; background: #e3f2fd; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 24px; text-align: center; color: #0d47a1; 
            box-shadow: 0 8px 15px rgba(21, 101, 192, 0.2); z-index: 2; flex-shrink: 0;
        }
        .vip-list { width: 400px; white-space: nowrap; line-height: 1.8; }
        
        .vip-title { font-size: 13px; color: #333; font-weight: bold; }
        .vip-name { font-size: 16px; color: #0d47a1; font-weight: 900; margin-left: 4px; }

        .vip-list.left { text-align: right; border-right: 3px solid #ddd; padding-right: 15px; }
        .vip-list.right { text-align: left; border-left: 3px solid #ddd; padding-left: 15px; }

        /* 圓桌 Grid */
        .guest-grid { display: grid; grid-template-columns: repeat(4, 180px); gap: 20px 40px; align-items: center; justify-content: center; }
        .table-circle { 
            width: 140px; height: 140px; border-radius: 50%; border: 2px solid #888; background: rgba(255,255,255,0.8); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 5px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.05); 
        }
        .table-circle b { font-size: 18px; color: #000; border-bottom: 2px solid #ccc; width: 85%; margin-bottom: 6px; font-weight: 900; }
        .unit-list { font-size: 13px; line-height: 1.3; color: #222; font-weight: bold; }
        
        /* 外單位強調色 (紅色粗體) */
        .ext-highlight { color: #d32f2f; font-weight: 900; }

        .pillar { background: #ffe0b2 !important; border: 1px solid #fb8c00; font-weight: 900; color: #e65100; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .bottom-row { margin-top: 60px; display: flex; justify-content: center; width: 100%; }
        .reception-group { display: flex; border: 2px solid #000; background: #fff; }
        .reception-box { border: 1px solid #000; padding: 15px 70px; font-weight: 900; font-size: 18px; }
        .footer { margin-top: 30px; text-align: center; border-top: 3px solid #555; padding-top: 20px; width: 100%; }
        
        .summary-panel { width: 1100px; background: white; border: 1px solid #333; padding: 35px; flex-shrink: 0; margin-bottom: 50px; }
        .summary-grid { display: grid; grid-template-columns: 1fr; gap: 40px; } 
        .stats-col { display: none; } 
        .summary-grid.show-stats { grid-template-columns: 1.2fr 1.8fr; }
        .summary-grid.show-stats .stats-col { display: block; }

        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f9f9f9; font-weight: 900; }
        .notice-text { color: #d32f2f; font-weight: 900; margin: 10px 0; font-size: 15px; }

        /* 列印設定 */
        @media print {
            @page { size: A3 portrait; margin: 5mm; }
            body, html { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; background: white !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .admin-panel, .expand-btn, button, .summary-panel, .options-box { display: none !important; }
            .chart-container { display: block; width: 100%; height: auto; overflow: visible; }
            .canvas { 
                width: 100% !important; height: 98vh !important; border: none !important; box-shadow: none !important; 
                margin: 0 auto !important; padding: 10px !important; background: white !important;
                transform: scale(0.9); transform-origin: top center; display: block; 
            }
            .left-facilities-area { position: absolute; left: 10px; top: 20px; }
            .divider-wall { position: absolute; left: 90px; top: 20px; bottom: 20px; height: 95%; background: #444 !important; -webkit-print-color-adjust: exact; }
            .banquet-hall { padding-left: 110px; width: auto; }
            .main-vip-wrapper, .guest-grid, .table-circle { page-break-inside: avoid; }
            .bottom-row { margin-top: 20px; }
            .footer { margin-top: 20px; padding-top: 15px; }
        }
    </style>
</head>
<body>

<button class="expand-btn" onclick="toggleSidebar(true)">⚙️ 設定</button>

<div class="admin-panel collapsed" id="adminPanel">
    <button class="collapse-btn" onclick="toggleSidebar(false)">❮</button>
    <h3>名單資料庫標記 (Tag)</h3>
    <textarea id="dataInput" oninput="updateAll()" placeholder="格式：姓名,桌號">局長葉協隆,主
前主秘余建勳,主
主任張博彥,主
疾病管制署高屏區管制中心主任王任鑫,主
高雄港警總隊總隊長廖國政,主
消防署港務消防大隊副大隊長戴國仰,主
高雄市國際輪船商業同業公會理事長吳岳峯,主
高雄市倉庫商業同業公會理事長駱啟明,主
高雄市船舶貨物裝卸承攬商業同業公會理事長黃德成,主
驗船中心處長高世榮,主
高雄市船務代理商業同業公會理事長顏銘傳,主
高雄港引水人辦事處主任陳策勤,主

副主任,4
港政科科長,4
港政科視察,4
港政科專員,4
港政科專員,4
監理科專員,4
疾病管制署高屏區管制中心賴旗美科長,4
裝卸公會,4
裝卸公會,4
裝卸公會,4

郭簡任技正,3
航安科專員,3
航安科專員,3
航安科,3
裝卸公會,3
裝卸公會,3
裝卸公會,3
高雄港引水人辦事處,3
高雄港引水人辦事處,3
國際輪船公會,3

黃簡任技正,2
局長隨行秘書,2
海技科科長,2
海技科技正,2
海技科技正,2
海技科專員,2
驗船中心,2
臺灣港務港勤公司處長李俊民,2
臺灣港務港勤公司處副理李柏遠,2
余建勳夫人,2

吳專門委員,1
安平航港科科長,1
安平航港科技正,1
安平航港科視察,1
安平航港科專員,1
監理科科長,1
監理科視察,1
船代公會,1
船代公會,1
船代公會,1

航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科(素食),7

航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科(素食),11

監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5

港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8

海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6

海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
政風,9

安平航港科,10
安平航港科,10
安平航港科,10
安平航港科,10
安平航港科,10
安平航港科,10
港政科,10
港政科,10
安平航港科,10
安平航港科,10</textarea>
    <div class="stats-summary" id="quickStats">已排人數：122 / 122人</div>
    <div class="options-box">
        <label><input type="checkbox" id="showStatsCheck" onchange="updateAll()"> 顯示人數統計表 (單位查核)</label>
    </div>
    <button onclick="window.print()" style="margin-top:15px; padding:12px; background:#333; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">列印完整報表</button>
</div>

<div class="chart-container">
    <div class="canvas">
        <div class="left-facilities-area">
            <div class="restroom-group">
                <div class="restroom-box">女</div>
                <div class="restroom-box">男</div>
            </div>
            <div class="elevator-box">⇅<br>電<br>梯</div>
        </div>
        <div class="divider-wall"></div>
        <div class="sound-control">音控台</div>
        <div class="banquet-hall">
            <div class="stage-box">舞 台</div>
            <div class="seating-area">
                <div class="main-vip-wrapper">
                    <div class="vip-list left" id="vipListLeft"></div>
                    <div class="main-table-circle">主 桌<br><span style="font-size:16px; margin-top:5px;">長官貴賓</span></div>
                    <div class="vip-list right" id="vipListRight"></div>
                </div>
                <div class="guest-grid">
                    <div class="table-circle"><b>第 1 桌</b><div class="unit-list" id="map-1"></div></div>
                    <div class="table-circle"><b>第 2 桌</b><div class="unit-list" id="map-2"></div></div>
                    <div class="table-circle"><b>第 3 桌</b><div class="unit-list" id="map-3"></div></div>
                    <div class="table-circle"><b>第 4 桌</b><div class="unit-list" id="map-4"></div></div>
                    <div class="table-circle"><b>第 5 桌</b><div class="unit-list" id="map-5"></div></div>
                    <div class="table-circle"><b>第 6 桌</b><div class="unit-list" id="map-6"></div></div>
                    <div class="table-circle"><b>第 7 桌</b><div class="unit-list" id="map-7"></div></div>
                    <div class="table-circle"><b>第 8 桌</b><div class="unit-list" id="map-8"></div></div>
                    <div class="table-circle"><b>第 9 桌</b><div class="unit-list" id="map-9"></div></div>
                    <div class="table-circle pillar">柱 子</div>
                    <div class="table-circle"><b>第 10 桌</b><div class="unit-list" id="map-10"></div></div>
                    <div class="table-circle"><b>第 11 桌</b><div class="unit-list" id="map-11"></div></div>
                </div>
            </div>
            <div class="bottom-row"><div class="reception-group"><div class="reception-box">接 待 處</div><div class="reception-box">接 待 處</div></div></div>
            <div class="footer">
                <div style="font-size:18px; font-weight:bold; color:#333;">交通部航港局南部航務中心</div>
                <h2 style="margin:8px 0; color:#000;">115年員工聯誼活動暨CIQS茶會</h2>
                <p style="color:#555;">115.1.23 (五) 18:00 入場 / 18:30 開始 | 地點：高雄翰品酒店 4樓兆慶廳 (大仁路43號)</p>
            </div>
        </div>
    </div>

    <div class="summary-panel">
        <div class="summary-grid" id="summaryGrid">
            <div class="stats-col">
                <h3>1. 單位查核 (人數統計)</h3>
                <table id="statsTable">
                    <thead><tr><th>單位/職稱</th><th>預計</th><th>實排</th><th>狀態</th><th>桌次</th></tr></thead>
                    <tbody id="statsBody"></tbody>
                </table>
            </div>
            <div>
                <h3>2. 賓客明細 (詳細清單)</h3>
                <div class="notice-text">※ 5~11桌位置可經雙方同意自行對調調整</div>
                <div id="indexContainer" style="font-size:18px; line-height:1.8;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleSidebar(show) {
        const panel = document.getElementById('adminPanel');
        const btn = document.querySelector('.expand-btn');
        if (show) { panel.classList.remove('collapsed'); btn.classList.add('hidden'); } 
        else { panel.classList.add('collapsed'); btn.classList.remove('hidden'); }
    }

    // 映射表：關鍵字 -> 圓圈顯示的簡稱 (要加公會)
    const mapGroupMap = {
        "國際輪船": "國際輪船公會",
        "港勤": "港勤公司",
        "引水人": "引水人辦事處",
        "驗船": "驗船中心",
        "裝卸": "裝卸公會",
        "船代": "船代公會",
        "倉庫": "倉庫公會",
        "理貨": "理貨公會",
        "疾管": "疾病管制署",
        "疾病管制": "疾病管制署",
        "港警": "港警總隊",
        "消防": "港務消防隊"
    };

    const externalKeywords = ["裝卸", "船代", "疾病管制署", "國際輪船", "港勤", "驗船", "消防", "倉庫", "理貨", "引水人", "港警"];
    const unitKeywords = ["航安科", "海技科", "港政科", "監理科", "安平航港科", "安平科", "裝卸公會", "船代公會", "疾病管制署", "國際輪船", "港勤", "驗船中心", "政風", "消防", "倉庫", "理貨", "引水人", "港警"];
    const titlesToKeep = ["局長", "隨行秘書", "主任", "副主任", "技正", "專門委員", "專委", "主秘", "夫人", "科長", "視察", "專員", "理事長", "總幹事", "處長", "大隊長", "隊長", "素", "素食", "副理"];

    // 圓圈專用：取得分組名稱
    function getMapGroupName(rawName) {
        // 先檢查關鍵字，優先回傳「單位名稱」
        for (let key in mapGroupMap) {
            if (rawName.includes(key)) {
                return mapGroupMap[key];
            }
        }
        // 檢查一般內部單位
        for (let unit of unitKeywords) {
            if (rawName.includes(unit)) {
                return unit;
            }
        }
        // VIP保留 (例如：吳專門委員 -> 吳專門委員)
        if (titlesToKeep.some(t => rawName.includes(t))) {
            if(rawName.includes("隨行")) return "局長隨行秘書";
            return rawName;
        }
        return rawName;
    }

    // 清單專用：取得詳細名稱 (需顯示全銜，不能只顯示單位)
    function getListDisplayName(rawName) {
        // 這裡我們盡量保持原樣 (因為資料庫已經是全銜)
        // 但如果有簡稱 (例如: "港勤")，我們要把它補全為 "港勤公司"
        
        // 如果 rawName 已經包含 "公會" 或 "公司"，就直接回傳 rawName
        if (rawName.includes("公會") || rawName.includes("公司") || rawName.includes("辦事處") || rawName.includes("中心")) {
            return rawName;
        }

        // 補全簡稱
        for (let key in mapGroupMap) {
            if (rawName === key || rawName.trim() === key) { // 只有完全等於簡稱時才補
                return mapGroupMap[key];
            }
        }
        
        return rawName;
    }

    function updateAll() {
        const showStats = document.getElementById('showStatsCheck').checked;
        const summaryGrid = document.getElementById('summaryGrid');
        if (showStats) summaryGrid.classList.add('show-stats');
        else summaryGrid.classList.remove('show-stats');

        const text = document.getElementById('dataInput').value;
        const lines = text.split('\n');
        const tables = { '主': [], '1': [], '2': [], '3': [], '4': [], '5': [], '6': [], '7': [], '8': [], '9': [], '10': [], '11': [] };
        let totalCount = 0;

        lines.forEach(line => {
            const parts = line.split(/[,\s\t]+/);
            if (parts.length >= 2) {
                const tableNum = parts[parts.length - 1].trim();
                const name = parts.slice(0, parts.length - 1).join(' ').trim();
                if (tables[tableNum] && name) {
                    tables[tableNum].push(name); 
                    totalCount++;
                }
            }
        });

        document.getElementById('quickStats').innerText = `已排人數：${totalCount} / 122人`;
        document.getElementById('statsBody').innerHTML = "<tr><td colspan='5' style='text-align:center; color:#999;'>統計資料運算已隱藏，僅計算總人數</td></tr>";

        const indexContainer = document.getElementById('indexContainer'); indexContainer.innerHTML = '';
        const displayOrder = ['主', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];
        
        displayOrder.forEach(key => {
            if (!tables[key]) return;
            const mapEl = document.getElementById('map-' + key);
            
            // --- 1. 主桌處理 ---
            if (key === '主') {
                const vipNames = tables[key]; 
                const half = Math.ceil(vipNames.length / 2);
                
                const formattedVips = vipNames.map(fullString => {
                    let title = "";
                    let name = fullString;
                    if (fullString.length > 3) {
                        name = fullString.slice(-3);
                        title = fullString.slice(0, -3);
                    }
                    return `<span class="vip-title">${title}</span><span class="vip-name">${name}</span>`;
                });
                
                const leftNames = formattedVips.slice(0, half);
                const rightNames = formattedVips.slice(half);

                document.getElementById('vipListLeft').innerHTML = leftNames.join('<br>');
                document.getElementById('vipListRight').innerHTML = rightNames.join('<br>');
            } else {
                // --- 2. 圓圈 (Map) 處理：使用分組邏輯 (Unit x Count) ---
                const mapLabelCounts = {};
                tables[key].forEach(name => {
                    let mapLabel = getMapGroupName(name);
                    mapLabelCounts[mapLabel] = (mapLabelCounts[mapLabel] || 0) + 1;
                });

                if (mapEl) {
                    const mapHtml = Object.entries(mapLabelCounts).map(([l, c]) => {
                        let labelHtml = l;
                        const isExternal = externalKeywords.some(key => l.includes(key));
                        if (isExternal) { labelHtml = `<span class="ext-highlight">${l}</span>`; }
                        return c > 1 ? `${labelHtml} x${c}` : labelHtml;
                    }).join('<br>');
                    mapEl.innerHTML = mapHtml;
                }
            }

            // --- 3. 清單 (List) 處理：顯示完整全銜 ---
            const listLabelCounts = {};
            tables[key].forEach(name => {
                let listLabel = getListDisplayName(name); // 使用清單專用邏輯
                listLabelCounts[listLabel] = (listLabelCounts[listLabel] || 0) + 1;
            });

            const listHtml = Object.entries(listLabelCounts).map(([l, c]) => c > 1 ? `${l} x${c}` : l).join('、');
            const title = key === '主' ? '主桌' : `第 ${key} 桌`;
            indexContainer.innerHTML += `<b>${title} (${tables[key].length}人):</b> ${listHtml}<br><hr style="border:0.5px solid #eee;">`;
        });
    }
    updateAll();
</script>

</body>
</html>
