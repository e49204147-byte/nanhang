<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>南航座位管理工具-115年正式版</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f5f5f5; display: flex; padding: 20px; gap: 20px; margin: 0; }
        .admin-panel { width: 340px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); height: 95vh; display: flex; flex-direction: column; }
        textarea { flex-grow: 1; width: 100%; font-family: monospace; padding: 10px; border: 1px solid #ccc; font-size: 13px; resize: none; border-radius: 4px; }
        .stats-summary { margin-top: 10px; padding: 10px; background: #f1f8e9; border-radius: 4px; font-size: 13px; font-weight: bold; border-left: 4px solid #4caf50; }
        .chart-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; gap: 30px; overflow-y: auto; height: 95vh; }
        .canvas { width: 950px; background: white; border: 2px solid #333; padding: 40px; position: relative; flex-shrink: 0; }
        .top-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; }
        .restroom-box { border: 1px solid #000; padding: 8px; width: 60px; text-align: center; font-weight: bold; font-size: 13px; }
        .stage-box { background: red; color: white; padding: 15px 90px; font-weight: bold; border: 1px solid #000; font-size: 22px; }
        .main-layout { display: flex; min-height: 650px; position: relative; }
        .left-facilities { width: 80px; display: flex; flex-direction: column; justify-content: center; }
        .elevator-box { border: 1px solid #000; padding: 15px 5px; text-align: center; background: #eee; font-weight: bold; font-size: 13px; }
        .guide-wall { width: 8px; background: #000; margin: 0 35px; border-radius: 0 0 4px 4px; height: 580px; }
        .seating-area { flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
        .main-table-circle { width: 150px; height: 150px; border-radius: 50%; border: 2px solid #1976d2; background: #e3f2fd; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 20px; margin-bottom: 35px; text-align: center; color: #0d47a1; }
        .guest-grid { display: grid; grid-template-columns: repeat(4, 155px); gap: 10px 20px; align-items: center; }
        .table-circle { width: 115px; height: 115px; border-radius: 50%; border: 1px solid #999; background: radial-gradient(circle, #ffffff, #f0f4f8); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 5px; }
        .table-circle b { font-size: 15px; color: #333; border-bottom: 1px solid #ccc; width: 85%; margin-bottom: 4px; }
        .unit-list { font-size: 11px; line-height: 1.3; color: #555; }
        .vip-line { grid-column: span 4; border-top: 2px dashed #d32f2f; text-align: center; font-size: 15px; font-weight: bold; color: #d32f2f; padding: 12px 0; margin: 10px 0; }
        .pillar { background: #ffe0b2 !important; border: 1px solid #fb8c00; font-weight: bold; color: #e65100; display: flex; align-items: center; justify-content: center; }
        .bottom-row { margin-top: 30px; display: flex; justify-content: center; width: 100%; }
        .reception-group { display: flex; border: 1.5px solid #000; background: #fff; }
        .reception-box { border: 0.5px solid #000; padding: 10px 60px; font-weight: bold; }
        .footer { margin-top: 30px; text-align: center; border-top: 2px solid #000; padding-top: 20px; width: 100%; }
        .summary-panel { width: 950px; background: white; border: 1px solid #333; padding: 35px; flex-shrink: 0; margin-bottom: 50px; }
        .summary-grid { display: grid; grid-template-columns: 1.2fr 1.8fr; gap: 40px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #f9f9f9; }
        .error { color: #d32f2f; font-weight: bold; background: #fffde7; }
        .success { color: #2e7d32; }
        .notice-text { color: #d32f2f; font-weight: bold; margin: 10px 0; font-size: 14px; }
        @media print { .admin-panel, .print-btn { display: none; } body { padding: 0; } .canvas, .summary-panel { border: none; box-shadow: none; } }
    </style>
</head>
<body>

<div class="admin-panel">
    <h3>名單資料庫標記 (Tag)</h3>
    <textarea id="dataInput" oninput="updateAll()" placeholder="格式：姓名,桌號">主任張博彥,主
余建勳,主
余建勳夫人,主
國際輪船理事長,主
國際輪船總幹事,主
倉庫公會理事長,主
裝卸公會理事長,主
理貨公會理事長,主
船代工會理事長,主

副主任,4
港政科科長,4
港政科視察,4
港政科專員,4
港政科專員,4
CDC,4
CDC,4
裝卸公會,4
裝卸公會,4
裝卸公會,4

郭簡任技正,3
航安科專員,3
航安科專員,3
航安科,3
港務消防戴副大隊長,3
裝卸公會,3
裝卸公會,3
裝卸公會,3
港勤公司,3
港勤公司,3

黃簡任技正,2
海技科科長,2
海技科技正,2
海技科技正,2
海技科專員,2
安平辦處技正,2
驗船中心,2
驗船中心,2

吳專門委員,1
安平辦處科長,1
安平辦處視察,1
安平辦處專員,1
監理科科長,1
監理科視察,1
監理科專員,1
船代,1
船代,1
船代,1

航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科(素食),7

航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科(素食),11

監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5

港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8

海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6

海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9

安平辦處,10
安平辦處,10
安平辦處,10
安平辦處,10
安平辦處,10
安平辦處,10
港政科,10
港政科,10
政風,10</textarea>
    <div class="stats-summary" id="quickStats">已排人數：115 / 115人</div>
    <button onclick="window.print()" style="margin-top:15px; padding:12px; background:#333; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">列印完整報表</button>
</div>

<div class="chart-container">
    <div class="canvas">
        <div class="top-row">
            <div style="display:flex; gap:8px;"><div class="restroom-box">女廁</div><div class="restroom-box">男廁</div></div>
            <div class="stage-box">舞 台</div>
            <div style="border:1px solid #000; padding:8px; background:#eee; font-size:12px; font-weight:bold;">音控台</div>
        </div>
        <div class="main-layout">
            <div class="left-facilities"><div class="elevator-box">⇅ 電梯</div></div>
            <div class="guide-wall"></div>
            <div class="seating-area">
                <div class="main-table-circle">主桌<br>長官貴賓</div>
                <div class="guest-grid">
                    <div class="table-circle"><b>第 1 桌</b><div class="unit-list" id="map-1"></div></div>
                    <div class="table-circle"><b>第 2 桌</b><div class="unit-list" id="map-2"></div></div>
                    <div class="table-circle"><b>第 3 桌</b><div class="unit-list" id="map-3"></div></div>
                    <div class="table-circle"><b>第 4 桌</b><div class="unit-list" id="map-4"></div></div>
                    <div class="vip-line">------------------ 專員以上請坐前四桌業務交流區 ------------------</div>
                    <div class="table-circle"><b>第 5 桌</b><div class="unit-list" id="map-5"></div></div>
                    <div class="table-circle"><b>第 6 桌</b><div class="unit-list" id="map-6"></div></div>
                    <div class="table-circle"><b>第 7 桌</b><div class="unit-list" id="map-7"></div></div>
                    <div class="table-circle"><b>第 8 桌</b><div class="unit-list" id="map-8"></div></div>
                    <div class="table-circle"><b>第 9 桌</b><div class="unit-list" id="map-9"></div></div>
                    <div class="table-circle pillar">柱 子</div>
                    <div class="table-circle"><b>第 10 桌</b><div class="unit-list" id="map-10"></div></div>
                    <div class="table-circle"><b>第 11 桌</b><div class="unit-list" id="map-11"></div></div>
                </div>
            </div>
        </div>
        <div class="bottom-row"><div class="reception-group"><div class="reception-box">接 待 處</div><div class="reception-box">接 待 處</div></div></div>
        <div class="footer"><div style="font-size:18px; font-weight:bold;">交通部航港局南部航務中心</div><h2 style="margin:8px 0;">115年員工聯誼活動暨CIQS茶會</h2><p>115.1.23 (晚) 席設：4F兆慶</p></div>
    </div>

    <div class="summary-panel">
        <div class="summary-grid">
            <div><h3>1. 單位查核 (人數統計)</h3><table id="statsTable"><thead><tr><th>單位/職稱</th><th>預計</th><th>實排</th><th>狀態</th><th>桌次</th></tr></thead><tbody id="statsBody"></tbody></table></div>
            <div>
                <h3>2. 賓客明細 (詳細清單)</h3>
                <div class="notice-text">※ 5~11桌位置可經雙方同意自行對調調整</div>
                <div id="indexContainer" style="font-size:13px; line-height:1.7;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const unitExpect = [
        { name: "副主任", count: 1 },
        { name: "主任", count: 1 },
        { name: "簡任技正", count: 2 },
        { name: "專門委員", count: 1, keys: ["專門委員","專委"] },
        { name: "航安科", count: 24, keys: ["航安"] }, 
        { name: "海技科", count: 23, keys: ["海技"] }, 
        { name: "港政科", count: 16, keys: ["港政"] },
        { name: "監理科", count: 12, keys: ["監理"] }, 
        { name: "安平辦處", count: 10, keys: ["安平"] }, 
        { name: "裝卸公會", count: 7 },
        { name: "船代", count: 4, keys: ["船代"] }, 
        { name: "CDC", count: 2 }, 
        { name: "國際輪船", count: 2 },
        { name: "港勤公司", count: 2, keys: ["港勤"] }, 
        { name: "驗船中心", count: 2, keys: ["驗船"] }, 
        { name: "政風", count: 1 },
        { name: "消防", count: 1 }, 
        { name: "倉庫公會", count: 1, keys: ["倉庫"] }, 
        { name: "理貨公會", count: 1, keys: ["理貨"] },
        { name: "余建勳", count: 2, keys: ["余建勳"] }
    ];

    function updateAll() {
        const text = document.getElementById('dataInput').value;
        const lines = text.split('\n');
        const tables = { '主': [], '1': [], '2': [], '3': [], '4': [], '5': [], '6': [], '7': [], '8': [], '9': [], '10': [], '11': [] };
        const unitActual = unitExpect.map(u => ({ ...u, actual: 0, tableSet: new Set() }));
        let total = 0;

        lines.forEach(line => {
            const parts = line.split(/[,\s\t]+/);
            if (parts.length >= 2) {
                const tableNum = parts[parts.length - 1].trim();
                const name = parts.slice(0, parts.length - 1).join(' ').trim();
                if (tables[tableNum] && name) {
                    tables[tableNum].push(name); total++;
                    for (let u of unitActual) {
                        const keys = u.keys || [u.name];
                        if (keys.some(k => name.includes(k))) {
                            u.actual++;
                            u.tableSet.add(tableNum);
                            break; 
                        }
                    }
                }
            }
        });

        document.getElementById('quickStats').innerText = `已排人數：${total} / 115人`;
        const statsBody = document.getElementById('statsBody'); statsBody.innerHTML = '';
        unitActual.forEach(u => {
            const isMatch = u.actual === u.count;
            const status = isMatch ? '<span class="success">✔ OK</span>' : `<span class="error">✘ 差${u.count - u.actual}</span>`;
            statsBody.innerHTML += `<tr><td>${u.name}</td><td>${u.count}</td><td>${u.actual}</td><td>${status}</td><td>${Array.from(u.tableSet).sort().join(',')}</td></tr>`;
        });

        const indexContainer = document.getElementById('indexContainer'); indexContainer.innerHTML = '';
        
        // 設定顯示順序：主桌排在第一位
        const displayOrder = ['主', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];
        
        displayOrder.forEach(key => {
            if (!tables[key]) return;
            const mapEl = document.getElementById('map-' + key);
            if (mapEl) {
                const units = [];
                tables[key].forEach(n => {
                    for (let u of unitExpect) {
                        const keys = u.keys || [u.name];
                        if (keys.some(k => n.includes(k))) {
                            if (!units.includes(u.name)) units.push(u.name);
                            break;
                        }
                    }
                });
                mapEl.innerHTML = units.join('<br>');
            }
            const title = key === '主' ? '主桌' : `第 ${key} 桌`;
            indexContainer.innerHTML += `<b>${title} (${tables[key].length}人):</b> ${tables[key].join('、')}<br><hr style="border:0.5px solid #eee;">`;
        });
    }
    updateAll();
</script>

</body>
</html>
