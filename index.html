<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>南部航務中心115年員工聯誼暨CIQS茶會人員配置圖</title>
    <style>
        /* --- 全局背景設定 --- */
        body { font-family: "Microsoft JhengHei", sans-serif; background: #333; display: flex; padding: 20px; gap: 20px; margin: 0; height: 100vh; overflow: hidden; }
        
        /* 左側管理面板 */
        .admin-panel { 
            width: 340px; background: #fff; padding: 20px; border-radius: 8px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.3); height: 95vh; 
            display: flex; flex-direction: column; transition: transform 0.3s ease;
            position: relative; z-index: 10;
        }
        .admin-panel.collapsed { transform: translateX(-380px); position: absolute; }
        .collapse-btn { position: absolute; top: 10px; right: 10px; background: #eee; border: none; border-radius: 50%; width: 30px; height: 30px; cursor: pointer; font-weight: bold; }
        .expand-btn { position: fixed; top: 20px; left: 0; z-index: 20; background: #333; color: white; border: none; padding: 10px 15px 10px 5px; border-radius: 0 50px 50px 0; cursor: pointer; font-weight: bold; transition: left 0.3s ease; }
        .expand-btn.hidden { left: -50px; }
        textarea { flex-grow: 1; width: 100%; font-family: monospace; padding: 10px; border: 1px solid #ccc; font-size: 13px; resize: none; border-radius: 4px; box-sizing: border-box; }
        .stats-summary { margin-top: 10px; padding: 10px; background: #f1f8e9; border-radius: 4px; font-size: 13px; font-weight: bold; border-left: 4px solid #4caf50; }
        .options-box { margin-top: 15px; font-weight: bold; color: #333; font-size: 14px; border-top: 1px solid #eee; padding-top: 10px; }
        .options-box label { cursor: pointer; display: flex; align-items: center; gap: 5px; }

        /* 右側圖表區 */
        .chart-container { flex-grow: 1; display: flex; flex-direction: column; align-items: center; gap: 30px; overflow-y: auto; height: 95vh; width: 100%; }
        
        /* --- 核心畫布 --- */
        .canvas { 
            width: 950px; 
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            border: 1px solid #ccc; padding: 40px; position: relative; flex-shrink: 0; margin-top: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
        }

        .top-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; }
        .restroom-box { border: 2px solid #555; padding: 8px; width: 60px; text-align: center; font-weight: bold; font-size: 13px; color: #555; }
        .stage-box { background: #d32f2f; color: white; padding: 15px 90px; font-weight: 900; border: 2px solid #b71c1c; font-size: 24px; letter-spacing: 5px; box-shadow: 0 4px 0 #922b21; border-radius: 4px; }
        .main-layout { display: flex; min-height: 750px; position: relative; }
        .left-facilities { width: 80px; display: flex; flex-direction: column; justify-content: center; }
        .elevator-box { border: 2px solid #555; padding: 15px 5px; text-align: center; background: #eee; font-weight: bold; font-size: 13px; color: #333; }
        .guide-wall { width: 8px; background: #444; margin: 0 35px; border-radius: 0 0 4px 4px; height: 680px; }
        .seating-area { flex-grow: 1; display: flex; flex-direction: column; align-items: center; }
        
        /* --- 主桌新佈局 (修正寬度，防止換行) --- */
        .main-vip-wrapper {
            display: flex; justify-content: center; align-items: center; gap: 20px;
            width: 100%; margin-bottom: 40px;
        }
        .main-table-circle { 
            width: 160px; height: 160px; border-radius: 50%; 
            border: 4px solid #1565c0; background: #e3f2fd; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: 900; font-size: 24px; text-align: center; color: #0d47a1; 
            box-shadow: 0 8px 15px rgba(21, 101, 192, 0.2); 
            z-index: 2; flex-shrink: 0;
        }
        .vip-list {
            font-size: 14px; font-weight: bold; line-height: 1.6; color: #333;
            width: 320px; 
            white-space: nowrap; 
        }
        .vip-list.left { text-align: right; border-right: 3px solid #ddd; padding-right: 15px; }
        .vip-list.right { text-align: left; border-left: 3px solid #ddd; padding-left: 15px; }

        /* 一般圓桌 */
        .guest-grid { display: grid; grid-template-columns: repeat(4, 180px); gap: 15px 25px; align-items: center; }
        .table-circle { 
            width: 140px; height: 140px; border-radius: 50%; 
            border: 2px solid #888; 
            background: rgba(255,255,255,0.8); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            text-align: center; padding: 5px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.05); 
        }
        .table-circle b { font-size: 18px; color: #000; border-bottom: 2px solid #ccc; width: 85%; margin-bottom: 6px; font-weight: 900; }
        .unit-list { font-size: 13px; line-height: 1.3; color: #222; font-weight: bold; }
        
        .vip-line { grid-column: span 4; border-top: 2px dashed #d32f2f; text-align: center; font-size: 16px; font-weight: 900; color: #d32f2f; padding: 15px 0; margin: 15px 0; }
        .pillar { background: #ffe0b2 !important; border: 1px solid #fb8c00; font-weight: 900; color: #e65100; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .bottom-row { margin-top: 40px; display: flex; justify-content: center; width: 100%; }
        .reception-group { display: flex; border: 2px solid #000; background: #fff; }
        .reception-box { border: 1px solid #000; padding: 15px 70px; font-weight: 900; font-size: 18px; }
        .footer { margin-top: 40px; text-align: center; border-top: 3px solid #555; padding-top: 25px; width: 100%; }
        
        .summary-panel { width: 950px; background: white; border: 1px solid #333; padding: 35px; flex-shrink: 0; margin-bottom: 50px; }
        .summary-grid { display: grid; grid-template-columns: 1fr; gap: 40px; } 
        .stats-col { display: none; } 
        .summary-grid.show-stats { grid-template-columns: 1.2fr 1.8fr; }
        .summary-grid.show-stats .stats-col { display: block; }

        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f9f9f9; font-weight: 900; }
        .notice-text { color: #d32f2f; font-weight: 900; margin: 10px 0; font-size: 15px; }

        /* --- 列印專用設定 (修正切邊問題) --- */
        @media print {
            @page { 
                size: A3 portrait; /* A3 直向 */
                margin: 5mm; 
            }
            body, html { 
                height: 100%; width: 100%; 
                margin: 0; padding: 0; 
                overflow: hidden; 
                background: white !important; 
                -webkit-print-color-adjust: exact; /* 強制列印背景色 */
                print-color-adjust: exact;
            }
            
            /* 隱藏不需要的元件 */
            .admin-panel, .expand-btn, button, .summary-panel, .options-box { display: none !important; }
            
            .chart-container { 
                display: block; 
                width: 100%; 
                height: auto; 
                overflow: visible; 
            }
            
            .canvas { 
                /* 關鍵修正：取消固定寬度，改用縮放 */
                width: 100% !important; 
                height: auto !important;
                border: none !important; 
                box-shadow: none !important; 
                margin: 0 auto !important; 
                padding: 10px !important;
                background: white !important;
                
                /* 縮放技巧 */
                transform: scale(0.9); /* 稍微縮小以適應邊界 */
                transform-origin: top center;
                /* zoom: 1.35; */ /* zoom 在某些瀏覽器會有問題，建議用 transform */
            }
            
            /* 避免被切斷 */
            .main-vip-wrapper, .guest-grid, .table-circle {
                page-break-inside: avoid;
            }
            
            .top-row, .main-layout, .bottom-row, .footer { 
                width: 100%; 
                max-width: 1000px; 
                margin-left: auto; 
                margin-right: auto;
            }
            .bottom-row { margin-top: 20px; }
            .footer { margin-top: 20px; padding-top: 15px; }
        }
    </style>
</head>
<body>

<button class="expand-btn" onclick="toggleSidebar(true)">⚙️ 設定</button>

<div class="admin-panel collapsed" id="adminPanel">
    <button class="collapse-btn" onclick="toggleSidebar(false)">❮</button>
    <h3>名單資料庫標記 (Tag)</h3>
    <textarea id="dataInput" oninput="updateAll()" placeholder="格式：姓名,桌號">局長葉協隆,主
前主秘余建勳,主
主任張博彥,主
疾病管制署高屏區管制中心主任王任鑫,主
高雄港警總隊總隊長廖國政,主
消防署港務消防大隊副大隊長戴國仰,主
高雄市國際輪船商業同業公會理事長吳岳峯,主
高雄市倉庫商業同業公會理事長駱啟明,主
高雄市船舶貨物裝卸承攬商業同業公會理事長黃德成,主
驗船中心處長高世榮,主
高雄市船務代理商業同業公會理事長顏銘傳,主
高雄港引水人辦事處主任陳策勤,主

副主任,4
港政科科長,4
港政科視察,4
港政科專員,4
港政科專員,4
監理科專員,4
疾病管制署高屏區管制中心,4
裝卸公會,4
裝卸公會,4
裝卸公會,4

郭簡任技正,3
航安科專員,3
航安科專員,3
航安科,3
裝卸公會,3
裝卸公會,3
裝卸公會,3
高雄港引水人辦事處,3
高雄港引水人辦事處,3
國際輪船公會,3

黃簡任技正,2
海技科科長,2
海技科技正,2
海技科技正,2
海技科專員,2
驗船中心,2
港勤公司,2
港勤公司,2
余建勳夫人,2
局長隨行秘書,2

吳專門委員,1
安平航港科科長,1
安平航港科技正,1
安平航港科視察,1
安平航港科專員,1
監理科科長,1
監理科視察,1
船代公會,1
船代公會,1
船代公會,1

航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科,7
航安科(素食),7

航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科,11
航安科(素食),11

監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5
監理科,5

港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8
港政科,8

海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6
海技科,6

海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
海技科,9
政風,9

安平航港科,10
安平航港科,10
安平航港科,10
安平航港科,10
安平航港科,10
安平航港科,10
港政科,10
港政科,10
安平航港科,10
安平航港科,10</textarea>
    <div class="stats-summary" id="quickStats">已排人數：122 / 122人</div>
    <div class="options-box">
        <label><input type="checkbox" id="showStatsCheck" onchange="updateAll()"> 顯示人數統計表 (單位查核)</label>
    </div>
    <button onclick="window.print()" style="margin-top:15px; padding:12px; background:#333; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">列印完整報表</button>
</div>

<div class="chart-container">
    <div class="canvas">
        <div class="top-row">
            <div style="display:flex; gap:8px;"><div class="restroom-box">女廁</div><div class="restroom-box">男廁</div></div>
            <div class="stage-box">舞 台</div>
            <div style="border:1px solid #000; padding:8px; background:#eee; font-size:12px; font-weight:bold;">音控台</div>
        </div>
        <div class="main-layout">
            <div class="left-facilities"><div class="elevator-box">⇅ 電梯</div></div>
            <div class="guide-wall"></div>
            <div class="seating-area">
                
                <div class="main-vip-wrapper">
                    <div class="vip-list left" id="vipListLeft"></div>
                    <div class="main-table-circle">主 桌<br><span style="font-size:16px; margin-top:5px;">長官貴賓</span></div>
                    <div class="vip-list right" id="vipListRight"></div>
                </div>

                <div class="guest-grid">
                    <div class="table-circle"><b>第 1 桌</b><div class="unit-list" id="map-1"></div></div>
                    <div class="table-circle"><b>第 2 桌</b><div class="unit-list" id="map-2"></div></div>
                    <div class="table-circle"><b>第 3 桌</b><div class="unit-list" id="map-3"></div></div>
                    <div class="table-circle"><b>第 4 桌</b><div class="unit-list" id="map-4"></div></div>
                
                    <div class="table-circle"><b>第 5 桌</b><div class="unit-list" id="map-5"></div></div>
                    <div class="table-circle"><b>第 6 桌</b><div class="unit-list" id="map-6"></div></div>
                    <div class="table-circle"><b>第 7 桌</b><div class="unit-list" id="map-7"></div></div>
                    <div class="table-circle"><b>第 8 桌</b><div class="unit-list" id="map-8"></div></div>
                    <div class="table-circle"><b>第 9 桌</b><div class="unit-list" id="map-9"></div></div>
                    <div class="table-circle pillar">柱 子</div>
                    <div class="table-circle"><b>第 10 桌</b><div class="unit-list" id="map-10"></div></div>
                    <div class="table-circle"><b>第 11 桌</b><div class="unit-list" id="map-11"></div></div>
                </div>
            </div>
        </div>
        <div class="bottom-row"><div class="reception-group"><div class="reception-box">接 待 處</div><div class="reception-box">接 待 處</div></div></div>
        <div class="footer">
            <div style="font-size:18px; font-weight:bold; color:#333;">交通部航港局南部航務中心</div>
            <h2 style="margin:8px 0; color:#000;">115年員工聯誼活動暨CIQS茶會</h2>
            <p style="color:#555;">115.1.23 (五) 18:00 入場 / 18:30 開始 | 地點：高雄翰品酒店 4樓兆慶廳 (大仁路43號)</p>
        </div>
    </div>

    <div class="summary-panel">
        <div class="summary-grid" id="summaryGrid">
            <div class="stats-col">
                <h3>1. 單位查核 (人數統計)</h3>
                <table id="statsTable">
                    <thead><tr><th>單位/職稱</th><th>預計</th><th>實排</th><th>狀態</th><th>桌次</th></tr></thead>
                    <tbody id="statsBody"></tbody>
                </table>
            </div>
            <div>
                <h3>2. 賓客明細 (詳細清單)</h3>
                <div class="notice-text">※ 5~11桌位置可經雙方同意自行對調調整</div>
                <div id="indexContainer" style="font-size:18px; line-height:1.8;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleSidebar(show) {
        const panel = document.getElementById('adminPanel');
        const btn = document.querySelector('.expand-btn');
        if (show) { panel.classList.remove('collapsed'); btn.classList.add('hidden'); } 
        else { panel.classList.add('collapsed'); btn.classList.remove('hidden'); }
    }

    const unitKeywords = ["航安科", "海技科", "港政科", "監理科", "安平航港科", "安平科", "裝卸公會", "船代公會", "疾病管制署", "國際輪船", "港勤", "驗船中心", "政風", "消防", "倉庫", "理貨", "引水人", "港警"];
    const titlesToKeep = ["局長", "隨行秘書", "主任", "副主任", "技正", "專門委員", "專委", "主秘", "夫人", "科長", "視察", "專員", "理事長", "總幹事", "處長", "大隊長", "隊長", "素", "素食"];

    function updateAll() {
        const showStats = document.getElementById('showStatsCheck').checked;
        const summaryGrid = document.getElementById('summaryGrid');
        if (showStats) summaryGrid.classList.add('show-stats');
        else summaryGrid.classList.remove('show-stats');

        const text = document.getElementById('dataInput').value;
        const lines = text.split('\n');
        const tables = { '主': [], '1': [], '2': [], '3': [], '4': [], '5': [], '6': [], '7': [], '8': [], '9': [], '10': [], '11': [] };
        let totalCount = 0;

        lines.forEach(line => {
            const parts = line.split(/[,\s\t]+/);
            if (parts.length >= 2) {
                const tableNum = parts[parts.length - 1].trim();
                const name = parts.slice(0, parts.length - 1).join(' ').trim();
                if (tables[tableNum] && name) {
                    tables[tableNum].push(name); 
                    totalCount++;
                }
            }
        });

        document.getElementById('quickStats').innerText = `已排人數：${totalCount} / 122人`;
        document.getElementById('statsBody').innerHTML = "<tr><td colspan='5' style='text-align:center; color:#999;'>統計資料運算已隱藏，僅計算總人數</td></tr>";

        const indexContainer = document.getElementById('indexContainer'); indexContainer.innerHTML = '';
        const displayOrder = ['主', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];
        
        displayOrder.forEach(key => {
            if (!tables[key]) return;
            const mapEl = document.getElementById('map-' + key);
            
            // --- 特殊處理：主桌 (分左右) ---
            if (key === '主') {
                const vipNames = tables[key]; // 主桌名單
                const half = Math.ceil(vipNames.length / 2);
                const leftNames = vipNames.slice(0, half);
                const rightNames = vipNames.slice(half);

                document.getElementById('vipListLeft').innerHTML = leftNames.join('<br>');
                document.getElementById('vipListRight').innerHTML = rightNames.join('<br>');
            } else {
                // --- 邏輯 A：一般圓圈 (極致合併 + 素食分離) ---
                const mapLabelCounts = {};
                tables[key].forEach(name => {
                    let mapLabel = name;
                    let merged = false;
                    
                    if (name.includes("葉協隆") || name.includes("隨行") || name.includes("張博彥") || name.includes("前主秘")) {
                        mapLabel = name;
                        if(name.includes("隨行")) mapLabel = "局長隨行秘書";
                        merged = true; 
                    } else if (name.includes("素")) {
                        mapLabel = name; 
                        merged = true;   
                    }

                    if (!merged) {
                        for (let unit of unitKeywords) {
                            if (name.includes(unit)) {
                                mapLabel = unit; 
                                break;
                            }
                        }
                    }
                    mapLabelCounts[mapLabel] = (mapLabelCounts[mapLabel] || 0) + 1;
                });

                if (mapEl) {
                    const mapHtml = Object.entries(mapLabelCounts).map(([l, c]) => c > 1 ? `${l} x${c}` : l).join('<br>');
                    mapEl.innerHTML = mapHtml;
                }
            }

            // --- 邏輯 B：詳細清單 (全部保留職稱) ---
            const listLabelCounts = {};
            tables[key].forEach(name => {
                let listLabel = name;
                const hasTitle = titlesToKeep.some(t => name.includes(t));
                if (hasTitle) {
                    listLabel = name;
                    if(name.includes("隨行")) listLabel = "局長隨行秘書";
                } else {
                    for (let unit of unitKeywords) {
                        if (name.includes(unit)) {
                            listLabel = unit;
                            break;
                        }
                    }
                }
                listLabelCounts[listLabel] = (listLabelCounts[listLabel] || 0) + 1;
            });

            const listHtml = Object.entries(listLabelCounts).map(([l, c]) => c > 1 ? `${l} x${c}` : l).join('、');
            const title = key === '主' ? '主桌' : `第 ${key} 桌`;
            indexContainer.innerHTML += `<b>${title} (${tables[key].length}人):</b> ${listHtml}<br><hr style="border:0.5px solid #eee;">`;
        });
    }
    updateAll();
</script>

</body>
</html>
